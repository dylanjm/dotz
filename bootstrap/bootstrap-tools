#!/usr/bin/env bash

sudo true
set -eo pipefail

NORMAL='\033[0m'
GREEN='\033[0;32m'
RED='\033[0;31m'
BLUE='\033[0;34m'

marker="${BLUE}==>${NORMAL}"
status="…"
status_good="${GREEN}✔${NORMAL}"
status_bad="${RED}✘${NORMAL}"

# shellcheck source=bootstrap-xcode-clt
source ./bootstrap/bootstrap-xcode-clt

# shellcheck source=bootstrap-homebrew
source ./bootstrap/bootstrap-homebrew

# shellcheck source=bootstrap-shell
source ./bootstrap/bootstrap-shell

printf "\n%s\n" "Would you like to upgrade/install dependencies from Brewfile?"
PS3="> "
select opt in "Yes" "No"; do
    case "$REPLY" in
    1)
        printf "%b\n" "Installing Brewfile $status"
        brew bundle --file="$(pwd)/bootstrap/Brewfile"
        break
        ;;
    2)
        printf "%b\n\n" "Skipping Brewfile install $status"
        break
        ;;
    *)
        printf "%s\n" "Invalid option! 1 for Yes, 2 for No"
        continue
        ;;
    esac
done

printf "%b\r" "$marker Checking font installations - $status"
if [[ "$(find ~/Library/Fonts/* -name "iosevka-*" -type f | wc -l 2>/dev/null)" -lt 200 ]]; then
    printf "%b\n" "$marker Checking font installations - $status_bad"

    # shellcheck source=bootstrap-fonts
    source ./bootstrap/bootstrap-fonts
else
    printf "%b\n" "$marker Checking font installations - $status_good"
fi
